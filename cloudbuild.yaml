steps:
# 1. Build Docker image
- name: 'gcr.io/cloud-builders/docker'
  args: ['build', '-t', 'gcr.io/$PROJECT_ID/cloud-app:latest', '.']

# 2. Push Docker image to Google Container Registry
- name: 'gcr.io/cloud-builders/docker'
  args: ['push', 'gcr.io/$PROJECT_ID/cloud-app:latest']

# 3. Get GKE cluster credentials
- name: 'gcr.io/cloud-builders/gcloud'
  args:
    - 'container'
    - 'clusters'
    - 'get-credentials'
    - 'cloud-app-cluster'
    - '--zone'
    - 'europe-west1-b'

# 4. Deploy to GKE (apply Kubernetes manifests)
- name: 'gcr.io/cloud-builders/kubectl'
  args:
    - 'apply'
    - '-f'
    - 'deployment.yaml'

# Optional: you can apply service and hpa yaml files similarly
# - name: 'gcr.io/cloud-builders/kubectl'
#   args: ['apply', '-f', 'k8s/service.yaml']
# - name: 'gcr.io/cloud-builders/kubectl'
#   args: ['apply', '-f', 'k8s/hpa.yaml']

images:
  - 'gcr.io/$PROJECT_ID/cloud-app:latest'
